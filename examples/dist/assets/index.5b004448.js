import{_ as P}from"./index.vue.b7077a39.js";import{l as V,U as X,o as L,c as T,d as _,g as v,f as w,_ as S,V as Q,X as j,K as G,Y as M,e as B,v as D,Z as N,$ as Y,a0 as H,a1 as W,a2 as J,x as K,M as Z,r as z,A as q,C as ee,h as te,a3 as ne,J as oe}from"./index.8e9cc30a.js";import{F as se,h as ie,a as R,v as ae,E as U,b as re}from"./validate.893fb05f.js";import"./logo.fb868fc0.js";(function(){function x(e){var s=document.getElementById(e.id),n=typeof e=="object"&&e;return new c(s,n)}var m=function(){var e=arguments.length,s=arguments[0]||{},n,a,r;for(typeof s!="object"&&typeof s!="function"&&(s={}),e==1&&(s=this,n--),n=1;n<e;n++){a=arguments[n];for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},i=function(e){return typeof e=="function"&&typeof e.nodeType!="number"},c=function(e,s){this.$element=e,this.options=m({},c.DEFAULTS,s),this.$element.style.position="relative",this.$element.style.width=this.options.width+"px",this.$element.style.margin="0 auto",this.init()},f;c.VERSION="1.0",c.Author="imooc_front@163.com",c.DEFAULTS={width:280,height:155,PI:Math.PI,sliderL:42,sliderR:9,offset:5,loadingText:"\u6B63\u5728\u52A0\u8F7D\u4E2D...",failedText:"\u518D\u8BD5\u4E00\u6B21",barText:"\u5411\u53F3\u6ED1\u52A8\u586B\u5145\u62FC\u56FE",repeatIcon:"iconfont iconfont-shuaxin",maxLoadCount:3,localImages:function(){return"images/Pic"+Math.round(Math.random()*4)+".jpg"},verify:function(e,s){var n=!1;return $.ajax({url:s,data:{datas:JSON.stringify(e)},dataType:"json",type:"post",async:!1,success:function(a){n=JSON.stringify(a),console.log("\u8FD4\u56DE\u7ED3\u679C\uFF1A"+n)}}),n},remoteUrl:""},window.sliderCaptcha=x,window.sliderCaptcha.Constructor=c,f=c.prototype,f.init=function(){this.initDOM(),this.initImg(),this.bindEvents()},f.initDOM=function(){var e=function(b,I){var y=document.createElement(b);return y.className=I,y},s=function(b,I){var y=document.createElement("canvas");return y.width=b,y.height=I,y},n=s(this.options.width-2,this.options.height),a=n.cloneNode(!0),r=e("div","sliderContainer"),d=e("i","refreshIcon "+this.options.repeatIcon),l=e("div","sliderMask"),t=e("div","sliderbg"),o=e("div","slider"),u=e("i","iconfont icon-arrow-right sliderIcon"),h=e("span","sliderText"),g,p;a.className="slider-captcha-block",h.innerHTML=this.options.barText,g=this.$element,g.appendChild(n),g.appendChild(d),g.appendChild(a),o.appendChild(u),l.appendChild(o),r.appendChild(t),r.appendChild(l),r.appendChild(h),g.appendChild(r),p={canvas:n,block:a,sliderContainer:r,refreshIcon:d,slider:o,sliderMask:l,sliderIcon:u,text:h,canvasCtx:n.getContext("2d"),blockCtx:a.getContext("2d")},i(Object.assign)?Object.assign(this,p):m(this,p)},f.initImg=function(){var e=this,s=window.navigator.userAgent.indexOf("Trident")>-1,n=this.options.sliderL+this.options.sliderR*2+3,a=function(t,o){var u=e.options.sliderL,h=e.options.sliderR,g=e.options.PI,p=e.x,b=e.y;t.beginPath(),t.moveTo(p,b),t.arc(p+u/2,b-h+2,h,.72*g,2.26*g),t.lineTo(p+u,b),t.arc(p+u+h-2,b+u/2,h,1.21*g,2.78*g),t.lineTo(p+u,b+u),t.lineTo(p,b+u),t.arc(p+h-2,b+u/2,h+.4,2.76*g,1.24*g,!0),t.lineTo(p,b),t.lineWidth=2,t.fillStyle="rgba(255, 255, 255, 0.7)",t.strokeStyle="rgba(255, 255, 255, 0.7)",t.stroke(),t[o](),t.globalCompositeOperation=s?"xor":"destination-over"},r=function(t,o){return Math.round(Math.random()*(o-t)+t)},d=new Image,l;d.crossOrigin="Anonymous",l=0,d.onload=function(){e.x=r(n+10,e.options.width-(n+10)),e.y=r(10+e.options.sliderR*2,e.options.height-(n+10)),a(e.canvasCtx,"fill"),a(e.blockCtx,"clip"),e.canvasCtx.drawImage(d,0,0,e.options.width-2,e.options.height),e.blockCtx.drawImage(d,0,0,e.options.width-2,e.options.height);var t=e.y-e.options.sliderR*2-1,o=e.blockCtx.getImageData(e.x-3,t,n,n);e.block.width=n,e.blockCtx.putImageData(o,0,t+1),e.text.textContent=e.text.getAttribute("data-text")},d.onerror=function(){if(l++,window.location.protocol==="file:"&&(l=e.options.maxLoadCount,console.error("can't load pic resource file from File protocal. Please try http or https")),l>=e.options.maxLoadCount){e.text.textContent="\u52A0\u8F7D\u5931\u8D25",e.classList.add("text-danger");return}d.src=e.options.localImages()},d.setSrc=function(){var t="",o;l=0,e.text.classList.remove("text-danger"),i(e.options.setSrc)&&(t=e.options.setSrc()),t&&t!==""||(t="https://picsum.photos/"+e.options.width+"/"+e.options.height+"/?image="+Math.round(Math.random()*200)),s?(o=new XMLHttpRequest,o.onloadend=function(u){var h=new FileReader;h.readAsDataURL(u.target.response),h.onloadend=function(g){d.src=g.target.result}},o.open("GET",t),o.responseType="blob",o.send()):d.src=t},d.setSrc(),this.text.setAttribute("data-text",this.options.barText),this.text.textContent=this.options.loadingText,this.img=d},f.clean=function(){this.canvasCtx.clearRect(0,0,this.options.width,this.options.height),this.blockCtx.clearRect(0,0,this.options.width,this.options.height),this.block.width=this.options.width},f.bindEvents=function(){var e=this;this.$element.addEventListener("selectstart",function(){return!1}),this.refreshIcon.addEventListener("click",function(){e.text.textContent=e.options.barText,e.reset(),i(e.options.onRefresh)&&e.options.onRefresh.call(e.$element)});var s,n,a=[],r=!1,d=function(o){e.text.classList.contains("text-danger")||(s=o.clientX||o.touches[0].clientX,n=o.clientY||o.touches[0].clientY,r=!0)},l=function(o){var u;if(!r)return!1;var h=o.clientX||o.touches[0].clientX,g=o.clientY||o.touches[0].clientY,p=h-s,b=g-n;if(p<0||p+40>e.options.width)return!1;e.slider.style.left=p-1+"px",u=(e.options.width-60)/(e.options.width-40)*p,e.block.style.left=u+"px",e.sliderContainer.classList.add("sliderContainer_active"),e.sliderMask.style.width=p+4+"px",a.push(Math.round(b))},t=function(o){var u,h;if(!r||(r=!1,u=o.clientX||o.changedTouches[0].clientX,u===s))return!1;e.sliderContainer.classList.remove("sliderContainer_active"),e.trail=a,h=e.verify(),h.spliced&&h.verified?(e.sliderContainer.classList.add("sliderContainer_success"),i(e.options.onSuccess)&&e.options.onSuccess.call(e.$element,a)):(e.sliderContainer.classList.add("sliderContainer_fail"),i(e.options.onFail)&&e.options.onFail.call(e.$element),setTimeout(function(){e.text.innerHTML=e.options.failedText,e.reset()},1e3))};this.slider.addEventListener("mousedown",d),this.slider.addEventListener("touchstart",d),document.addEventListener("mousemove",l),document.addEventListener("touchmove",l),document.addEventListener("mouseup",t),document.addEventListener("touchend",t),document.addEventListener("mousedown",function(){return!1}),document.addEventListener("touchstart",function(){return!1}),document.addEventListener("swipe",function(){return!1})},f.verify=function(){var e=this.trail,s=parseInt(this.block.style.left),n=!1;if(this.options.remoteUrl!==null)n=this.options.verify(e,this.options.remoteUrl);else{var a=function(o,u){return o+u},r=function(o){return o*o},d=e.reduce(a)/e.length,l=e.map(function(o){return o-d}),t=Math.sqrt(l.map(r).reduce(a)/e.length);n=t!==0}return{spliced:Math.abs(s-this.x)<this.options.offset,verified:n}},f.reset=function(){this.sliderContainer.classList.remove("sliderContainer_fail"),this.sliderContainer.classList.remove("sliderContainer_success"),this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.text.setAttribute("data-text",this.text.textContent),this.text.textContent=this.options.loadingText,this.img.setSrc()}})();const ce={class:"fixed top-[20%] left-[50%] translate-x-[-50%] w-[340px] h-[270px] text-sm bg-white dark:bg-zinc-800 rounded border border-zinc-200 dark:border-zinc-900 shadow-2xl"},le={class:"flex items-center h-5 text-left px-1 mb-1"},de=_("span",{class:"flex-grow dark:text-zinc-200"},"\u8BF7\u5B8C\u6210\u5B89\u5168\u9A8C\u8BC1",-1),ue=_("div",{id:"captcha"},null,-1),A="close",F="success",he={__name:"slider-captcha",emits:[A,F],setup(x,{emit:m}){let i=null;V(()=>{i=sliderCaptcha({id:"captcha",async onSuccess(e){await X({behavior:e})&&m(F)},onFail(){console.log("onFail")},verify(){return!0}})});const c=()=>{i.reset()},f=()=>{m(A)};return(e,s)=>(L(),T("div",ce,[_("div",le,[de,v(w(S),{name:"refresh",fillClass:"fill-zinc-900 dark:fill-zinc-200",class:"w-3 h-3 p-0.5 rounded-sm duration-300 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900",onClick:c}),v(w(S),{name:"close",fillClass:"fill-zinc-900 dark:fill-zinc-200",class:"ml-2 w-3 h-3 p-0.5 rounded-sm duration-300 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900",onClick:f})]),ue]))}},E="LOGIN_SUCCESS_CHANNEL";let C=null;window.BroadcastChannel&&(C=new BroadcastChannel(E));const pe=()=>new Promise((x,m)=>{C?C.onmessage=async i=>{x(i.data)}:window.onstorage=i=>{i.key===E&&x(JSON.parse(i.newValue))}}),me=x=>{C?C.postMessage(x):localStorage.setItem(E,JSON.stringify(x))},fe=()=>{C&&(C.close(),C=null),localStorage.removeItem(E)},k={wait:pe,send:me,clear:fe},O=async(x,m)=>{if(await Q.dispatch("user/login",{loginType:x,...m})===j){G("success",`\u6B22\u8FCE\u60A8 ${m.nickname}\uFF0C\u8BF7\u521B\u5EFA\u60A8\u7684\u8D26\u53F7`,6e3),M.push({path:"/register",query:{reqType:x,...m}});return}M.push("/")},ge={id:"qqLoginBtn"},xe="https://graph.qq.com/oauth2.0/authorize?client_id=101998494&response_type=token&scope=all&redirect_uri=https%3A%2F%2Fimooc-front.lgdsunday.club%2Flogin",be={__name:"qq-login",setup(x){V(()=>{QC.Login({btnId:"qqLoginBtn"},(c,f)=>{console.log("QQ\u767B\u5F55\u6210\u529F"),console.log(c),QC.Login.signOut();const e=/access_token=((.*))&expires_in/.exec(window.location.hash)[1],s={nickname:c.nickname,figureurl_qq_2:c.figureurl_qq_2,accessToken:e};k.send(s),O(N,s),window.close()})});const m=()=>{i()},i=async()=>{window.open(xe,"oauth2Login_10609","height=525,width=585, toolbar=no, menubar=no, scrollbars=no, status=no, location=yes, resizable=yes"),k.wait().then(async c=>{k.clear(),O(N,c)})};return(c,f)=>(L(),T("div",null,[B(_("span",ge,null,512),[[D,!1]]),v(w(S),{class:"w-4 cursor-pointer",name:"qq",onClick:m})]))}},ve=_("div",{id:"login_container"},null,-1),we={__name:"weixin-login",setup(x){if(window.location.search){const i=/code=((.*))&state/.exec(window.location.search)[1];i&&(k.send({code:i}),window.close())}const m=async()=>{const{appId:i,appSecret:c,redirectUri:f,scope:e,state:s}=await Y();window.open(`https://open.weixin.qq.com/connect/qrconnect?appid=${i}&redirect_uri=${f}&response_type=code&scope=${e}&state=${s}#wechat_redirect`,"","height=525,width=585, toolbar=no, menubar=no, scrollbars=no, status=no, location=yes, resizable=yes"),k.wait().then(async({code:n})=>{console.log("\u5FAE\u4FE1\u626B\u7801\u767B\u5F55\u6210\u529F"),console.log(n),k.clear();const{access_token:a,openid:r}=await H(i,c,n);console.log("access_token, openid"),console.log(a,r);const{nickname:d,headimgurl:l}=await W(a,r);console.log(d,l),O(J,{openid:r,nickname:d,headimgurl:l})})};return(i,c)=>(L(),T("div",{onClick:m},[v(w(S),{class:"w-4 cursor-pointer",name:"wexin"}),ve]))}},_e={class:"relative h-screen bg-white dark:bg-zinc-800 text-center xl:bg-zinc-200"},Ce={class:"block px-3 mt-4 dark:bg-zinc-800 xl:bg-white xl:w-[388px] xl:dark:bg-zinc-900 xl:m-auto xl:mt-8 xl:py-4 xl:rounded-sm xl:shadow-lg"},ye=_("h3",{class:"hidden mb-2 font-semibold text-base text-main dark:text-zinc-300 xl:block"}," \u8D26\u53F7\u767B\u5F55 ",-1),ke={class:"flex justify-around mt-4"},Ie={__name:"index",setup(x){const m=K(),i=Z(),c=z(!1),f=()=>{c.value=!0},e=()=>{c.value=!1,a()},s=z(!1),n=z({username:"LGD_Sunday",password:"123123"}),a=async()=>{s.value=!0;try{await m.dispatch("user/login",{...n.value,loginType:ne})}finally{s.value=!1}i.push("/")},r=()=>{m.commit("app/changeRouterType","push"),i.push("/register")};return(d,l)=>(L(),T("div",_e,[v(ie),_("div",Ce,[ye,v(w(se),{onSubmit:f},{default:q(()=>[v(w(R),{class:"dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b w-full outline-0 pb-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:default:bg-zinc-900",type:"text",name:"username",placeholder:"\u7528\u6237\u540D",autocomplete:"on",rules:w(ae),modelValue:n.value.username,"onUpdate:modelValue":l[0]||(l[0]=t=>n.value.username=t)},null,8,["rules","modelValue"]),v(w(U),{class:"text-sm text-red-600 block mt-0.5 text-left",name:"username"}),v(w(R),{class:"dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b w-full outline-0 pb-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:default:bg-zinc-900",type:"password",name:"password",placeholder:"\u5BC6\u7801",autocomplete:"on",rules:w(re),modelValue:n.value.password,"onUpdate:modelValue":l[1]||(l[1]=t=>n.value.password=t)},null,8,["rules","modelValue"]),v(w(U),{class:"text-sm text-red-600 block mt-0.5 text-left",name:"password"}),_("div",{class:"pt-1 pb-3 leading-[0px] text-right"},[_("a",{class:"inline-block p-1 text-zinc-400 text-right dark:text-zinc-600 hover:text-zinc-600 dark:hover:text-zinc-400 text-sm duration-300 cursor-pointer",onClick:r},"\u53BB\u6CE8\u518C")]),v(w(P),{class:"w-full dark:bg-zinc-900 xl:dark:bg-zinc-800",isActiveAnim:!1,loading:s.value},{default:q(()=>[oe("\u767B\u5F55")]),_:1},8,["loading"]),_("div",ke,[v(be),v(we)])]),_:1})]),c.value?(L(),ee(he,{key:0,onClose:l[2]||(l[2]=t=>c.value=!1),onSuccess:e})):te("",!0)]))}};export{Ie as default};
